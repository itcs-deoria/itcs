<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Polls</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9fafb;
      text-align: center;
      padding: 20px;
    }
    header {
      margin-bottom: 20px;
    }
    header img {
      height: 60px;
      margin-bottom: 10px;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
      color: #333;
    }

    .instructions {
      max-width: 600px;
      margin: 20px auto;
      padding: 15px;
      background: #fff8e6;
      border: 1px solid #ffd27f;
      border-radius: 8px;
      text-align: left;
    }
    .instructions h3 {
      margin-top: 0;
      color: #b36b00;
    }
    .instructions ul {
      padding-left: 20px;
      margin: 10px 0;
    }

    .progress-container {
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      background: #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 20px;
      width: 0%;
      background: #2563eb;
      text-align: center;
      color: white;
      font-size: 12px;
      line-height: 20px;
      transition: width 0.5s;
    }
    .progress-text {
      margin-top: 5px;
      font-size: 14px;
    }

    .poll-container {
      max-width: 500px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    .poll-container h2 {
      margin-bottom: 10px;
      color: #444;
    }
    .poll-status {
      font-size: 14px;
      margin-bottom: 15px;
      color: red;
    }
    .poll-status.unlocked {
      color: green;
    }
    .poll-container button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    .poll-container button:hover {
      background: #1e4ed8;
    }
    .poll-link {
      margin-top: 15px;
      display: none;
    }
    .poll-link a {
      color: #2563eb;
      text-decoration: none;
      font-weight: bold;
    }
    .success-message {
      margin-top: 10px;
      color: green;
      font-weight: bold;
      display: none;
    }

    .emoji-burst {
      display: none;
      font-size: 24px;
      position: absolute;
      right: 10px;
      top: 10px;
      animation: burst 1s ease forwards;
    }
    @keyframes burst {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    .pin-popup {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .pin-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      width: 300px;
    }
    .pin-box input {
      padding: 8px;
      width: 80%;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .pin-box button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="ITCS.png" alt="Institute Logo">
    <h1>IT Computer Studies - Student Polls</h1>
  </header>

  <div class="instructions">
    <h3>üìù Instructions</h3>
    <ul>
      <li>Please wait for teacher‚Äôs instruction.</li>
      <li>Enter correct PIN to unlock the poll.</li>
      <li>Complete all polls step by step.</li>
    </ul>
  </div>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>
  <div class="progress-text" id="progressText">0/4 Completed ‚úÖ</div>

  <!-- Polls -->
  <div class="poll-container" id="poll1">
    <h2>Poll 1</h2>
    <div class="poll-status">üîí Locked</div>
    <button onclick="openPinPopup(1)">Unlock Poll</button>
    <div class="poll-link"><a href="https://forms.gle/PtuKnnEgeCBpCdXJ7" >Go to Poll 1</a></div>
    <div class="success-message">‚úÖ Great! You can now attempt Poll 1.</div>
    <div class="emoji-burst">üéâ</div>
  </div>

  <div class="poll-container" id="poll2">
    <h2>Poll 2</h2>
    <div class="poll-status">üîí Locked</div>
    <button onclick="openPinPopup(2)">Unlock Poll</button>
    <div class="poll-link"><a href="https://forms.gle/nQ2SeyRgFeCA9Qeg9" >Go to Poll 2</a></div>
    <div class="success-message">‚úÖ Great! You can now attempt Poll 2.</div>
    <div class="emoji-burst">üåü</div>
  </div>

  <div class="poll-container" id="poll3">
    <h2>Poll 3</h2>
    <div class="poll-status">üîí Locked</div>
    <button onclick="openPinPopup(3)">Unlock Poll</button>
    <div class="poll-link"><a href="https://forms.gle/7yGSm7AmYEyWgAdr7" >Go to Poll 3</a></div>
    <div class="success-message">‚úÖ Great! You can now attempt Poll 3.</div>
    <div class="emoji-burst">‚úÖ</div>
  </div>

  <div class="poll-container" id="poll4">
    <h2>Poll 4</h2>
    <div class="poll-status">üîí Locked</div>
    <button onclick="openPinPopup(4)">Unlock Poll</button>
    <div class="poll-link"><a href="https://forms.gle/4DDs56McjyYiFfdS8" target="_blank">Go to Poll 4</a></div>
    <div class="success-message">‚úÖ Great! You can now attempt Poll 4.</div>
    <div class="emoji-burst">üî•</div>
  </div>

  <div class="pin-popup" id="pinPopup">
    <div class="pin-box">
      <h3>Enter Teacher PIN</h3>
      <input type="password" id="pinInput" placeholder="Enter PIN">
      <br>
      <button onclick="checkPin()">Submit</button>
      <button onclick="closePinPopup()" style="background:red;">Cancel</button>
    </div>
  </div>

  <script>
    const pollPins = { 1: "itcs-U121", 2: "itcs-czs12", 3: "itcs-gsr23", 4: "itcs-gfr34" };
    let currentPoll = null;
    let completedPolls = 0;

    // Load saved state from localStorage
    window.onload = function() {
      for (let i = 1; i <= 4; i++) {
        if (localStorage.getItem("poll" + i) === "unlocked") {
          unlockPoll(i, false); // restore without increment
        }
      }
      completedPolls = parseInt(localStorage.getItem("completedPolls")) || 0;
      updateProgress();
    };

    function openPinPopup(pollId) {
      currentPoll = pollId;
      document.getElementById("pinPopup").style.display = "flex";
    }

    function closePinPopup() {
      document.getElementById("pinPopup").style.display = "none";
      document.getElementById("pinInput").value = "";
    }

    function checkPin() {
      const enteredPin = document.getElementById("pinInput").value;
      if (enteredPin === pollPins[currentPoll]) {
        unlockPoll(currentPoll, true);
        closePinPopup();
      } else {
        alert("‚ùå Wrong PIN. Please try again.");
      }
    }

    function unlockPoll(pollId, isNew) {
      const pollDiv = document.getElementById("poll" + pollId);
      pollDiv.querySelector("button").style.display = "none";
      pollDiv.querySelector(".poll-link").style.display = "block";
      pollDiv.querySelector(".success-message").style.display = "block";
      pollDiv.querySelector(".poll-status").textContent = "‚úÖ Unlocked";
      pollDiv.querySelector(".poll-status").classList.add("unlocked");

      // Success animation only if new unlock
      if (isNew) {
        const emoji = pollDiv.querySelector(".emoji-burst");
        emoji.style.display = "block";
        setTimeout(() => { emoji.style.display = "none"; }, 1000);

        completedPolls++;
        localStorage.setItem("completedPolls", completedPolls);
        localStorage.setItem("poll" + pollId, "unlocked");
        updateProgress();
      }
    }

    function updateProgress() {
      const totalPolls = 4;
      const percent = Math.round((completedPolls / totalPolls) * 100);
      const bar = document.getElementById("progressBar");
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";
      document.getElementById("progressText").textContent =
        `${completedPolls}/${totalPolls} Completed ‚úÖ`;
    }
  </script>
</body>
</html>
